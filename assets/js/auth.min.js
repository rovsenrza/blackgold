function simpleHash(e){let t=0;for(let s=0;s<e.length;s++){t=(t<<5)-t+e.charCodeAt(s),t&=t}return t.toString()}function getAllUsers(){const e=localStorage.getItem("blackGoldUsers");if(e)try{return JSON.parse(e)}catch(e){return console.error("Error parsing users:",e),{}}return{}}function saveAllUsers(e){localStorage.setItem("blackGoldUsers",JSON.stringify(e))}function getCurrentUser(){const e=localStorage.getItem("currentUserId");if(!e)return null;return getAllUsers()[e]||null}function setCurrentUser(e){localStorage.setItem("currentUserId",e)}function logout(){localStorage.removeItem("currentUserId"),window.location.href="login.html"}function createUserData(e,t,s,r){return{id:Date.now().toString(),username:e,email:t,name:s,passwordHash:r,createdAt:(new Date).toISOString(),accounts:[],currentAccountId:null,theme:"dark",language:"en",notifications:!0,watchlist:[],cryptoPrices:{},stockPrices:{},stakedTokens:0,country:"",phone:""}}function registerUser(e,t,s,r){const n=getAllUsers();for(const s in n)if(n[s].username===e||n[s].email===t)return{success:!1,message:"Username or email already exists"};if(r.length<6)return{success:!1,message:"Password must be at least 6 characters"};const o=createUserData(e,t,s,simpleHash(r));return n[o.id]=o,saveAllUsers(n),{success:!0,userId:o.id}}function loginUser(e,t){const s=getAllUsers(),r=simpleHash(t);for(const t in s){const n=s[t];if((n.username===e||n.email===e)&&n.passwordHash===r)return setCurrentUser(t),{success:!0,userId:t,user:n}}return{success:!1,message:"Invalid username/email or password"}}function getUserAccounts(e){const t=getAllUsers()[e];return t&&t.accounts||[]}function saveUserAccounts(e,t){const s=getAllUsers();return!!s[e]&&(s[e].accounts=t,saveAllUsers(s),!0)}function getUserCurrentAccount(e){const t=getAllUsers()[e];if(!t)return null;if(!t.currentAccountId)return null;return(t.accounts||[]).find(e=>e.id===t.currentAccountId)||null}function setUserCurrentAccount(e,t){const s=getAllUsers();return!!s[e]&&(s[e].currentAccountId=t,saveAllUsers(s),!0)}function updateUserProperty(e,t,s){const r=getAllUsers();return!!r[e]&&(r[e][t]=s,saveAllUsers(r),!0)}function getUserProperty(e,t){const s=getAllUsers()[e];return s?s[t]:null}function initAuthPage(){const e=document.getElementById("login-tab"),t=document.getElementById("register-tab"),s=document.getElementById("login-form"),r=document.getElementById("register-form"),n=document.getElementById("login-submit"),o=document.getElementById("register-submit"),l=document.getElementById("auth-message");function i(e,t=!1){l.textContent=e,l.className="mb-4 p-3 rounded-lg text-sm "+(t?"bg-red-600/20 border border-red-600/30 text-red-400":"bg-green-600/20 border border-green-600/30 text-green-400"),l.classList.remove("hidden"),setTimeout(()=>{l.classList.add("hidden")},5e3)}getCurrentUser()?window.location.replace("index.html"):(e.addEventListener("click",function(){e.classList.add("bg-gold-600/20","text-gold-400"),e.classList.remove("text-gold-600","hover:text-gold-400","hover:bg-gold-600/10"),t.classList.remove("bg-gold-600/20","text-gold-400"),t.classList.add("text-gold-600","hover:text-gold-400","hover:bg-gold-600/10"),s.classList.remove("hidden"),r.classList.add("hidden"),l.classList.add("hidden")}),t.addEventListener("click",function(){t.classList.add("bg-gold-600/20","text-gold-400"),t.classList.remove("text-gold-600","hover:text-gold-400","hover:bg-gold-600/10"),e.classList.remove("bg-gold-600/20","text-gold-400"),e.classList.add("text-gold-600","hover:text-gold-400","hover:bg-gold-600/10"),r.classList.remove("hidden"),s.classList.add("hidden"),l.classList.add("hidden")}),n&&(n.addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("login-username").value.trim(),s=document.getElementById("login-password").value;if(!t||!s)return void i("Please fill in all fields",!0);const r=loginUser(t,s);r.success?(i("Login successful! Redirecting...",!1),setTimeout(()=>{window.location.replace("index.html")},500)):i(r.message||"Login failed",!0)}),document.getElementById("login-password").addEventListener("keypress",e=>{"Enter"===e.key&&n.click()})),o&&(o.addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("register-name").value.trim(),s=document.getElementById("register-username").value.trim(),r=document.getElementById("register-email").value.trim(),n=document.getElementById("register-password").value,o=document.getElementById("register-confirm-password").value;if(!(t&&s&&r&&n&&o))return void i("Please fill in all fields",!0);if(n!==o)return void i("Passwords do not match",!0);if(n.length<6)return void i("Password must be at least 6 characters",!0);if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r))return void i("Please enter a valid email address",!0);const l=registerUser(s,r,t,n);l.success?(setCurrentUser(l.userId),i("Account created successfully! Redirecting...",!1),setTimeout(()=>{window.location.replace("index.html")},500)):i(l.message||"Registration failed",!0)}),document.getElementById("register-confirm-password").addEventListener("keypress",e=>{"Enter"===e.key&&o.click()})))}function shouldInitAuth(){const e=window.location.pathname,t=window.location.href;return e.includes("login.html")||t.includes("login.html")}shouldInitAuth()&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",initAuthPage):initAuthPage());