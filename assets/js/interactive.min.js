function initTabs(){document.querySelectorAll("[data-tabs]").forEach(t=>{const e=t.querySelectorAll("[data-tab-button]"),o=t.parentElement.querySelectorAll("[data-tab-panel]");e.forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-tab-button");e.forEach(t=>{t.getAttribute("data-tab-button")===n?(t.classList.remove("text-gold-600","hover:text-gold-400","hover:bg-gold-600/10"),t.classList.add("bg-gold-600/20","text-gold-400")):(t.classList.remove("bg-gold-600/20","text-gold-400"),t.classList.add("text-gold-600","hover:text-gold-400","hover:bg-gold-600/10"))}),o.forEach(t=>{t.getAttribute("data-tab-panel")===n?t.classList.remove("hidden"):t.classList.add("hidden")})})})})}function initModals(){document.querySelectorAll("[data-modal-open]").forEach(t=>{t.addEventListener("click",e=>{const o=t.getAttribute("data-modal-open"),n=document.getElementById(o);if(n){n.classList.remove("hidden"),document.body.style.overflow="hidden";const a=t.getAttribute("data-card-data");if(a)try{populateModalWithCardData(n,JSON.parse(a))}catch(e){console.error("Error parsing card data:",e)}const r=t.getAttribute("data-stake-data");if(r&&"stake-modal"===o)try{populateStakeModal(n,JSON.parse(r))}catch(e){console.error("Error parsing stake data:",e)}const d=t.getAttribute("data-trade-data");if(d&&"trade-modal"===o)try{const t=JSON.parse(d);populateTradeModal(n,t)}catch(e){console.error("Error parsing trade data:",e)}const s=t.getAttribute("data-card-type");if(s&&"order-card-modal"===o){const t=n.querySelector("[data-modal-title]");if(t){const e={classic:"Order Classic Card",world:"Order World Card",premium:"Order World Premium Card"};t.textContent=e[s]||"Order Card"}const e=n.querySelector("[data-card-preview]");if(e){const t=e.querySelector("[data-card-name]"),o=e.querySelector("[data-card-icon]"),n={classic:{name:"Classic Card"},world:{name:"World Card"},premium:{name:"World Premium Card"}},a='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gold-400">\n              <rect width="5" height="5" x="3" y="3" rx="1"></rect>\n              <rect width="5" height="5" x="16" y="3" rx="1"></rect>\n              <rect width="5" height="5" x="3" y="16" rx="1"></rect>\n              <path d="M21 16h-3a2 2 0 0 0-2 2v3"></path>\n              <path d="M21 21v.01"></path>\n              <path d="M12 7v3a2 2 0 0 1-2 2H7"></path>\n              <path d="M3 12h.01"></path>\n              <path d="M12 3h.01"></path>\n              <path d="M12 16v.01"></path>\n              <path d="M16 12h1"></path>\n              <path d="M21 12v.01"></path>\n              <path d="M12 21v-1"></path>\n            </svg>',r=n[s]||n.classic;t&&(t.textContent=r.name),o&&(o.innerHTML=a)}const o=n.querySelector("#card-name-input"),a=n.querySelector("#card-phone-input"),r=n.querySelector("[data-card-holder-name]"),d=n.querySelector("[data-card-holder-phone]");o&&r&&o.addEventListener("input",t=>{r.textContent=t.target.value||"CARD HOLDER NAME"}),a&&d&&a.addEventListener("input",t=>{d.textContent=t.target.value||"+994 XX XXX XX XX"})}}})}),document.querySelectorAll("[data-modal-close]").forEach(t=>{t.addEventListener("click",()=>{const e=t.closest("[data-modal]");e&&(e.classList.add("hidden"),document.body.style.overflow="")})}),document.querySelectorAll("[data-modal]").forEach(t=>{"stock-modal"!==t.id&&t.addEventListener("click",e=>{e.target===t&&(t.classList.add("hidden"),document.body.style.overflow="")})}),document.addEventListener("keydown",t=>{"Escape"===t.key&&document.querySelectorAll("[data-modal]").forEach(t=>{t.classList.contains("hidden")||(t.classList.add("hidden"),document.body.style.overflow="")})})}function populateStakeModal(t,e){const o=t.querySelector("[data-modal-title]");o&&(o.textContent=`Stake ${e.name||""}`);const n=t.querySelector("[data-modal-content]");n&&e&&(n.innerHTML=`\n      <div class="space-y-6">\n        <div class="flex items-center space-x-3">\n          <div class="w-16 h-16 bg-orange-600/20 rounded-lg flex items-center justify-center">\n            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-400">\n              <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>\n            </svg>\n          </div>\n          <div>\n            <h3 class="text-xl font-semibold text-gold-400">${e.name||""}</h3>\n            <p class="text-gold-600">${e.symbol||""}</p>\n          </div>\n        </div>\n        <div class="bg-gold-600/10 rounded-lg p-4">\n          <h4 class="text-gold-400 font-semibold mb-2">Current Price</h4>\n          <p class="text-gold-400 text-2xl font-bold">${e.price||""}</p>\n          <p class="text-gold-600 text-sm mt-1">${e.change||""}</p>\n        </div>\n        <div>\n          <h4 class="text-gold-400 font-semibold mb-2">Staking Details</h4>\n          <p class="text-gold-600 text-sm leading-relaxed">${e.description||""}</p>\n        </div>\n        <div class="grid grid-cols-3 gap-4 text-center">\n          <div class="bg-black/30 rounded-lg p-3">\n            <p class="text-gold-400 font-semibold">${e.apy||""}</p>\n            <p class="text-gold-600 text-xs">APY</p>\n          </div>\n          <div class="bg-black/30 rounded-lg p-3">\n            <p class="text-gold-400 font-semibold">${e.minStake||""}</p>\n            <p class="text-gold-600 text-xs">Min Stake</p>\n          </div>\n          <div class="bg-black/30 rounded-lg p-3">\n            <p class="text-gold-400 font-semibold">${e.lockPeriod||""}</p>\n            <p class="text-gold-600 text-xs">Lock Period</p>\n          </div>\n        </div>\n        <div class="space-y-4">\n          <h4 class="text-gold-400 font-semibold">Stake Amount</h4>\n          <input type="number" class="w-full bg-black/50 border border-gold-600/30 rounded-lg px-4 py-2 text-gold-400 focus:border-gold-500 focus:outline-none" placeholder="Enter amount" min="${e.minStake?e.minStake.replace("$",""):"0"}">\n          <button class="w-full bg-gradient-to-r from-gold-600 to-gold-500 hover:from-gold-500 hover:to-gold-400 text-black hover:shadow-lg hover:shadow-gold-600/30 font-medium rounded-lg px-4 py-2 text-sm transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold-400/50 cursor-pointer">\n            Confirm Stake\n          </button>\n        </div>\n      </div>\n    `)}function populateTradeModal(t,e){const o=t.querySelector("[data-modal-title]");o&&(o.textContent=`Trade ${e.symbol||""}`);const n=t.querySelector("[data-modal-content]");if(n&&e){const t=e.change&&e.change.includes("-")?"text-red-400":"text-green-400";n.innerHTML=`\n      <div class="space-y-6">\n        <div class="flex items-center space-x-3">\n          <div class="w-16 h-16 bg-gold-600/20 rounded-lg flex items-center justify-center text-4xl">\n            ${"TSLA"===e.symbol?"üöó":"AAPL"===e.symbol?"üçé":"SHEL"===e.symbol?"üõ¢Ô∏è":"üìà"}\n          </div>\n          <div>\n            <h3 class="text-xl font-semibold text-gold-400">${e.name||""}</h3>\n            <p class="text-gold-600">${e.symbol||""}</p>\n          </div>\n        </div>\n        <div class="bg-gold-600/10 rounded-lg p-4">\n          <h4 class="text-gold-400 font-semibold mb-2">Current Price</h4>\n          <p class="text-gold-400 text-2xl font-bold">${e.price||""}</p>\n          <p class="${t} text-sm mt-1 font-semibold">${e.change||""}</p>\n          <span class="inline-block mt-2 px-2 py-1 rounded text-xs font-medium ${"Technology"===e.sector?"text-blue-400 bg-blue-600/20":"Energy"===e.sector?"text-orange-400 bg-orange-600/20":"text-green-400 bg-green-600/20"}">${e.sector||""}</span>\n        </div>\n        <div>\n          <h4 class="text-gold-400 font-semibold mb-2">Company Description</h4>\n          <p class="text-gold-600 text-sm leading-relaxed">${e.description||""}</p>\n        </div>\n        <div class="space-y-4">\n          <h4 class="text-gold-400 font-semibold">Trade Options</h4>\n          <div class="flex space-x-2">\n            <button class="flex-1 bg-gradient-to-r from-gold-600 to-gold-500 hover:from-gold-500 hover:to-gold-400 text-black hover:shadow-lg hover:shadow-gold-600/30 font-medium rounded-lg px-4 py-2 text-sm transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold-400/50 cursor-pointer">Buy Shares</button>\n            <button class="flex-1 bg-gold-600/20 hover:bg-gold-600/30 text-gold-400 border border-gold-600/30 hover:border-gold-500/50 font-medium rounded-lg px-4 py-2 text-sm transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold-400/50 cursor-pointer">Sell Shares</button>\n          </div>\n          <div>\n            <label class="block text-gold-400 text-sm font-medium mb-2">Number of Shares</label>\n            <input type="number" class="w-full bg-black/50 border border-gold-600/30 rounded-lg px-4 py-2 text-gold-400 focus:border-gold-500 focus:outline-none" placeholder="0" min="1">\n          </div>\n          <button class="w-full border border-gold-600 text-gold-400 hover:bg-gold-600/10 hover:border-gold-500 font-medium rounded-lg px-4 py-2 text-sm transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold-400/50 cursor-pointer">\n            Add to Watchlist\n          </button>\n        </div>\n      </div>\n    `}}function populateModalWithCardData(t,e){const o=t.querySelector("[data-modal-title]");o&&(o.textContent=e.title||"");const n=t.querySelector("[data-modal-content]");n&&e&&(n.innerHTML=`\n      <div class="space-y-6">\n        <div class="flex items-center space-x-3">\n          <div class="w-16 h-16 bg-green-600/20 rounded-lg flex items-center justify-center">\n            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-400">\n              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>\n              <path d="M2 17l10 5 10-5"></path>\n              <path d="M2 12l10 5 10-5"></path>\n            </svg>\n          </div>\n          <div>\n            <h3 class="text-xl font-semibold text-gold-400">${e.title||""}</h3>\n            <p class="text-gold-600">${e.location||""}</p>\n          </div>\n        </div>\n        <div class="bg-gold-600/10 rounded-lg p-4">\n          <h4 class="text-gold-400 font-semibold mb-2">Environmental Impact</h4>\n          <p class="text-gold-600">${e.impact||""}</p>\n        </div>\n        <div>\n          <h4 class="text-gold-400 font-semibold mb-2">Project Details</h4>\n          <p class="text-gold-600 text-sm leading-relaxed">${e.details||""}</p>\n        </div>\n        <div class="grid grid-cols-3 gap-4 text-center">\n          <div class="bg-black/30 rounded-lg p-3">\n            <p class="text-gold-400 font-semibold">${e.raised||""}</p>\n            <p class="text-gold-600 text-xs">Raised</p>\n          </div>\n          <div class="bg-black/30 rounded-lg p-3">\n            <p class="text-gold-400 font-semibold">${e.participants||""}</p>\n            <p class="text-gold-600 text-xs">Investors</p>\n          </div>\n          <div class="bg-black/30 rounded-lg p-3">\n            <p class="text-gold-400 font-semibold">${e.progress||""}%</p>\n            <p class="text-gold-600 text-xs">Complete</p>\n          </div>\n        </div>\n        <div class="space-y-4">\n          <h4 class="text-gold-400 font-semibold">Investment Options</h4>\n          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">\n            <button data-invest-amount="100" class="px-3 py-1.5 text-sm border border-gold-600 text-gold-400 hover:bg-gold-600/10 hover:border-gold-500 font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold-400/50 cursor-pointer invest-option-btn">$100</button>\n            <button data-invest-amount="500" class="px-3 py-1.5 text-sm border border-gold-600 text-gold-400 hover:bg-gold-600/10 hover:border-gold-500 font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold-400/50 cursor-pointer invest-option-btn">$500</button>\n            <button data-invest-amount="1000" class="px-3 py-1.5 text-sm border border-gold-600 text-gold-400 hover:bg-gold-600/10 hover:border-gold-500 font-medium rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold-400/50 cursor-pointer invest-option-btn">$1,000</button>\n          </div>\n          <div>\n            <label class="block text-gold-400 text-sm font-medium mb-2">Or Enter Custom Amount</label>\n            <input type="number" id="invest-custom-amount" step="0.01" min="0" class="w-full bg-black/50 border border-gold-600/30 rounded-lg px-4 py-2 text-gold-400 focus:border-gold-500 focus:outline-none" placeholder="0.00">\n          </div>\n          <button id="invest-now-btn" class="w-full bg-gradient-to-r from-gold-600 to-gold-500 hover:from-gold-500 hover:to-gold-400 text-black hover:shadow-lg hover:shadow-gold-600/30 font-medium rounded-lg px-4 py-2 text-sm transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gold-400/50 cursor-pointer">\n            Invest Now\n          </button>\n        </div>\n      </div>\n    `,setTimeout(()=>{initInvestModal()},100))}function initInvestModal(){const t=document.getElementById("invest-modal");if(!t)return;let e=0;t.querySelectorAll(".invest-option-btn").forEach(o=>{const n=o.cloneNode(!0);o.parentNode.replaceChild(n,o),n.addEventListener("click",o=>{o.stopPropagation(),t.querySelectorAll(".invest-option-btn").forEach(t=>{t.classList.remove("bg-gold-600/20","border-gold-500"),t.classList.add("border-gold-600")}),n.classList.add("bg-gold-600/20","border-gold-500"),n.classList.remove("border-gold-600"),e=parseFloat(n.getAttribute("data-invest-amount"));const a=t.querySelector("#invest-custom-amount");a&&(a.value="")})});const o=t.querySelector("#invest-custom-amount");o&&o.addEventListener("input",o=>{o.stopPropagation();const n=parseFloat(o.target.value);!isNaN(n)&&n>0&&(e=n,t.querySelectorAll(".invest-option-btn").forEach(t=>{t.classList.remove("bg-gold-600/20","border-gold-500"),t.classList.add("border-gold-600")}))});const n=t.querySelector("#invest-now-btn");if(n){const a=n.cloneNode(!0);n.parentNode.replaceChild(a,n),a.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();let a=e;if(o&&o.value){const t=parseFloat(o.value);!isNaN(t)&&t>0&&(a=t)}if(!a||a<=0)return void alert("Please select an investment amount or enter a custom amount");const r=loadBankAccounts().find(t=>"current"===t.accountType);if(!r)return void alert("No current account found. Please set up a current account first.");if(r.balance<a)return void alert("Insufficient balance. Please check your account balance.");r.balance-=a;const d=loadBankAccounts(),s=d.findIndex(t=>t.id===r.id);-1!==s?d[s]=r:d.push(r);const c=getCurrentUserId();if(c&&"function"==typeof saveUserAccounts)saveUserAccounts(c,d);else{const t=getUserStorageKey("bankAccounts");localStorage.setItem(t,JSON.stringify(d))}window.updateHeaderBalance&&window.updateHeaderBalance(),alert(`Successfully invested $${a.toFixed(2)} in the project!`),t.classList.add("hidden"),document.body.style.overflow="",e=0,t.querySelectorAll(".invest-option-btn").forEach(t=>{t.classList.remove("bg-gold-600/20","border-gold-500"),t.classList.add("border-gold-600")}),o&&(o.value="")})}const a=t.querySelector("div.rounded-xl");a&&a.addEventListener("click",t=>{t.stopPropagation()});t.querySelectorAll("input, button").forEach(t=>{t.addEventListener("click",t=>{t.stopPropagation()}),t.addEventListener("focus",t=>{t.stopPropagation()})})}function initLanguageDropdown(){const t={en:{flag:"üá∫üá∏",name:"English",code:"EN"},az:{flag:"üá¶üáø",name:"Az…ôrbaycan",code:"AZ"},tr:{flag:"üáπüá∑",name:"T√ºrk√ße",code:"TR"},ru:{flag:"üá∑üá∫",name:"–†—É—Å—Å–∫–∏–π",code:"RU"},ar:{flag:"üá∏üá¶",name:"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",code:"AR"},fr:{flag:"üá´üá∑",name:"Fran√ßais",code:"FR"},de:{flag:"üá©üá™",name:"Deutsch",code:"DE"},es:{flag:"üá™üá∏",name:"Espa√±ol",code:"ES"}};let e=getUserItem("selectedLanguage")||"en";document.querySelectorAll("[data-language-dropdown]").forEach(o=>{const n=o.querySelector("[data-language-button]"),a=o.querySelector("[data-language-menu]"),r=o.querySelector("[data-language-backdrop]"),d=o.querySelector("[data-language-display]"),s=o.querySelector("[data-language-chevron]"),c=o.querySelectorAll("[data-language-option]"),l=e=>{const o=t[e];d&&o&&(d.textContent=`${o.flag} ${o.code}`),c.forEach(t=>{t.getAttribute("data-language-option")===e?(t.classList.remove("text-gold-600"),t.classList.add("bg-gold-600/20","text-gold-400")):(t.classList.remove("bg-gold-600/20","text-gold-400"),t.classList.add("text-gold-600"))})};l(e),n.addEventListener("click",t=>{t.stopPropagation();!a.classList.contains("hidden")?(a.classList.add("hidden"),r.classList.add("hidden"),s.classList.remove("rotate-180")):(a.classList.remove("hidden"),r.classList.remove("hidden"),s.classList.add("rotate-180"))}),c.forEach(t=>{t.addEventListener("click",o=>{o.stopPropagation();const n=t.getAttribute("data-language-option");e=n,setUserItem("selectedLanguage",n),l(n),a.classList.add("hidden"),r.classList.add("hidden"),s.classList.remove("rotate-180")})}),r.addEventListener("click",()=>{a.classList.add("hidden"),r.classList.add("hidden"),s.classList.remove("rotate-180")}),document.addEventListener("keydown",t=>{"Escape"!==t.key||a.classList.contains("hidden")||(a.classList.add("hidden"),r.classList.add("hidden"),s.classList.remove("rotate-180"))})})}function initForecastPage(){if(!document.querySelector("[data-forecast-timeframes]"))return;const t=82.45;let e=7,o=!1;const n={7:{accuracy:85,predictedPrice:85.2,confidence:78,trend:"bullish"},14:{accuracy:78,predictedPrice:84.5,confidence:75,trend:"bullish"},30:{accuracy:72,predictedPrice:83.8,confidence:70,trend:"bullish"},90:{accuracy:65,predictedPrice:82.9,confidence:65,trend:"stable"}},a=[["OPEC+ production cuts","Increased global demand","Geopolitical tensions","Seasonal consumption patterns"],["OPEC+ production decisions","Global economic indicators","Seasonal demand patterns","Inventory level changes"],["Currency fluctuations","Renewable energy adoption","Market sentiment","Supply chain disruptions"],["Long-term economic trends","Energy transition policies","Global trade patterns","Climate regulations"]];function r(o){e=o;const r=n[o];if(!r)return;const s=document.querySelector("[data-forecast-confidence]");s&&(s.textContent=`${r.confidence}%`);const c=document.querySelector("[data-forecast-days-text]");c&&(c.textContent=`${o} day forecast`);const l=document.querySelector("[data-forecast-price]");l&&(l.textContent=`$${r.predictedPrice.toFixed(2)}`);const i=document.querySelector("[data-forecast-trend]");i&&(i.textContent=`${r.trend} trend`,i.className="text-sm mt-1 "+("bullish"===r.trend?"text-green-400":"bearish"===r.trend?"text-red-400":"text-gold-400"));const u=(r.predictedPrice-t)/t*100,m=document.querySelector("[data-forecast-change]");m&&(m.textContent=`${u>=0?"+":""}${u.toFixed(2)}%`,m.className="text-2xl font-bold "+(u>=0?"text-green-400":"text-red-400"));const g=document.querySelector("[data-forecast-factors]");if(g){const t=7===o?0:14===o?1:30===o?2:3;g.innerHTML=a[t].map(t=>`\n        <li class="text-gold-600 text-sm flex items-center space-x-2">\n          <span class="text-gold-400">‚Ä¢</span>\n          <span>${t}</span>\n        </li>\n      `).join("")}d(o)}function d(t){const e=document.querySelector("[data-chart-bars]");if(!e)return;e.innerHTML="";let o=7;(14===t||30===t||90===t)&&(o=7);const n=Math.min(4,Math.floor(.6*o));for(let a=0;a<o;a++){const r=0===a,d=a>=n,s=30+55*(a/(o-1))+(10*Math.random()-5),c=Math.max(25,Math.min(95,s));let l="";l=r?"Now":7===t?`+${a}d`:14===t?`+${2*a}d`:30===t?`+${Math.round(4.3*a)}d`:`+${Math.round(13*a)}d`;const i=document.createElement("div");i.className="flex flex-col items-center space-y-2",i.innerHTML=`\n        <div class="w-6 rounded-t ${r?"bg-gold-400":d?"bg-blue-400/70":"bg-gold-600/70"}" style="height: ${c}%"></div>\n        <span class="text-xs text-gold-600">${l}</span>\n      `,e.appendChild(i)}}const s=document.querySelectorAll("[data-forecast-days]");s.forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.getAttribute("data-forecast-days"));s.forEach(t=>{parseInt(t.getAttribute("data-forecast-days"))===e?(t.classList.remove("border","border-gold-600","text-gold-400","hover:bg-gold-600/10","hover:border-gold-500"),t.classList.add("bg-gradient-to-r","from-gold-600","to-gold-500","hover:from-gold-500","hover:to-gold-400","text-black","hover:shadow-lg","hover:shadow-gold-600/30")):(t.classList.remove("bg-gradient-to-r","from-gold-600","to-gold-500","hover:from-gold-500","hover:to-gold-400","text-black","hover:shadow-lg","hover:shadow-gold-600/30"),t.classList.add("border","border-gold-600","text-gold-400","hover:bg-gold-600/10","hover:border-gold-500"))}),r(e)})});const c=document.querySelector("[data-refresh-forecast]");c&&c.addEventListener("click",function(){if(o)return;o=!0;const a=document.querySelector("[data-chart-bars]"),d=document.querySelector("[data-chart-loading]"),s=document.querySelector("[data-refresh-forecast]");a&&(a.style.opacity="0.3"),d&&(d.classList.remove("hidden"),d.style.display="flex"),s&&(s.disabled=!0,s.textContent="Analyzing...",s.style.opacity="0.6",s.style.cursor="not-allowed"),setTimeout(()=>{const c=Math.random()>.5?1:-1,l=t+.05*t*c*(e/7),i=Math.max(50,90-e/7*5),u=l>t?"bullish":"bearish";n[e]={accuracy:n[e].accuracy,predictedPrice:parseFloat(l.toFixed(2)),confidence:Math.round(i),trend:u},r(e),a&&(a.style.opacity="1"),d&&(d.classList.add("hidden"),d.style.display="none"),s&&(s.disabled=!1,s.textContent="Refresh Forecast",s.style.opacity="1",s.style.cursor="pointer"),o=!1},2e3)}),d(e)}function initProfilePage(){const t=getUserItem("userName");if(t){const e=document.querySelector('[data-profile-field="name"][data-profile-display]');e&&(e.textContent=t);const o=document.querySelector('[data-profile-field="name"][data-profile-input]');o&&(o.value=t)}const e=document.querySelector("[data-profile-edit-toggle]"),o=document.querySelector("[data-profile-form]");let n=!1;const a={};if(e&&o){document.querySelectorAll("[data-profile-display]").forEach(t=>{const e=t.getAttribute("data-profile-field");a[e]=t.textContent.trim()}),e.addEventListener("click",()=>{if(n=!n,n){e.textContent="Cancel",e.classList.remove("bg-gold-600/20"),e.classList.add("border","border-gold-600/30","hover:bg-gold-600/30"),document.querySelectorAll("[data-profile-display]").forEach(t=>{t.classList.add("hidden")}),document.querySelectorAll("[data-profile-input]").forEach(t=>{t.classList.remove("hidden")});const t=document.querySelector("[data-profile-save]");t&&t.classList.remove("hidden")}else{e.textContent="Edit",e.classList.add("bg-gold-600/20"),e.classList.remove("border","border-gold-600/30","hover:bg-gold-600/30"),document.querySelectorAll("[data-profile-input]").forEach(t=>{const e=t.getAttribute("data-profile-field");t.value=a[e]}),document.querySelectorAll("[data-profile-display]").forEach(t=>{t.classList.remove("hidden")}),document.querySelectorAll("[data-profile-input]").forEach(t=>{t.classList.add("hidden")});const t=document.querySelector("[data-profile-save]");t&&t.classList.add("hidden")}});const t=document.querySelector("[data-profile-save]");t&&t.addEventListener("click",()=>{document.querySelectorAll("[data-profile-input]").forEach(t=>{const e=t.getAttribute("data-profile-field"),o=document.querySelector(`[data-profile-field="${e}"][data-profile-display]`);if(o){const n=t.value;if(o.textContent=n,a[e]=n,"name"===e){setUserItem("userName",n);const t=getCurrentUserId();t&&"function"==typeof updateUserProperty&&updateUserProperty(t,"name",n);document.querySelectorAll("[data-header-name]").forEach(t=>{t.textContent=`Welcome, ${n}`})}}}),n=!1,e.textContent="Edit",e.classList.add("bg-gold-600/20"),e.classList.remove("border","border-gold-600/30","hover:bg-gold-600/30"),document.querySelectorAll("[data-profile-display]").forEach(t=>{t.classList.remove("hidden")}),document.querySelectorAll("[data-profile-input]").forEach(t=>{t.classList.add("hidden")}),t.classList.add("hidden")})}const r=document.querySelector("[data-settings-language]");if(r){const t=getUserItem("selectedLanguage")||"en";r.value=t,r.addEventListener("change",t=>{const e=t.target.value;setUserItem("selectedLanguage",e);const o=document.querySelector("[data-language-display]");if(o){const t={en:"üá∫üá∏ EN",az:"üá¶üáø AZ",tr:"üáπüá∑ TR",ru:"üá∑üá∫ RU"};o.textContent=t[e]||t.en}})}const d=document.querySelector("[data-settings-theme]"),s=document.querySelector("[data-theme-icon]");if(d){let t=getUserItem("theme")||"dark";updateThemeButton(t,d,s),d.addEventListener("click",()=>{t="dark"===t?"light":"dark",setUserItem("theme",t),applyTheme(t);const e=getCurrentUserId();e&&"function"==typeof updateUserProperty&&updateUserProperty(e,"theme",t)})}const c=document.querySelector("[data-settings-notifications]");if(c){let t="false"!==getUserItem("notifications");updateNotificationsButton(t,c),c.addEventListener("click",()=>{t=!t,setUserItem("notifications",t.toString()),updateNotificationsButton(t,c);const e=getCurrentUserId();e&&"function"==typeof updateUserProperty&&updateUserProperty(e,"notifications",t)})}const l=document.getElementById("logout-button");l&&l.addEventListener("click",()=>{"function"==typeof logout?logout():(localStorage.removeItem("currentUserId"),window.location.href="login.html")})}function applyTheme(t){const e=document.documentElement,o=document.body;"light"===t?(e.classList.add("light-mode"),e.classList.remove("dark-mode"),o.classList.add("light-mode"),o.classList.remove("dark-mode"),e.style.setProperty("--bg-primary","#f8f9fa"),e.style.setProperty("--bg-secondary","#ffffff"),e.style.setProperty("--text-primary","#1a1a1a"),e.style.setProperty("--text-secondary","#4a5568"),e.style.setProperty("--border-color","#e2e8f0")):(e.classList.add("dark-mode"),e.classList.remove("light-mode"),o.classList.add("dark-mode"),o.classList.remove("light-mode"),e.style.setProperty("--bg-primary","#000000"),e.style.setProperty("--bg-secondary","#111827"),e.style.setProperty("--text-primary","#fbbf24"),e.style.setProperty("--text-secondary","#d97706"),e.style.setProperty("--border-color","rgba(217, 119, 6, 0.3)"));const n=document.querySelector("[data-settings-theme]"),a=document.querySelector("[data-theme-icon]");n&&updateThemeButton(t,n,a)}function updateThemeButton(t,e,o){"dark"===t?(e.textContent="Dark Mode",e.className="px-3 py-1.5 border border-gold-600/30 text-gold-400 hover:bg-gold-600/10 rounded-lg text-sm transition-colors",o&&(o.innerHTML='<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>')):(e.textContent="Light Mode",e.className="px-3 py-1.5 border border-gold-600/30 text-gold-400 hover:bg-gold-600/10 rounded-lg text-sm transition-colors",o&&(o.innerHTML='<circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path>'))}function initTheme(){applyTheme(getUserItem("theme")||"dark")}function updateNotificationsButton(t,e){t?(e.textContent="Enabled",e.className="px-3 py-1.5 bg-gradient-to-r from-gold-600 to-gold-500 hover:from-gold-500 hover:to-gold-400 text-black font-medium rounded-lg text-sm transition-all duration-300"):(e.textContent="Disabled",e.className="px-3 py-1.5 border border-gold-600/30 text-gold-400 hover:bg-gold-600/10 rounded-lg text-sm transition-colors")}function loadUserName(){const t=getUserItem("userName");if(!t){if(getCurrentUserId()&&"function"==typeof getCurrentUser){const t=getCurrentUser();if(t&&t.name){setUserItem("userName",t.name);return void document.querySelectorAll("[data-header-name]").forEach(e=>{e.textContent=`Welcome, ${t.name}`})}}}if(t){document.querySelectorAll("[data-header-name]").forEach(e=>{e.textContent=`Welcome, ${t}`})}}let marketTickerInterval=null,marketTickerCurrentPrices={};function initMarketTicker(){const t=document.querySelector("[data-ticker-content]");if(t){t.querySelectorAll(".inline-flex.items-center").forEach((t,e)=>{const o=t.querySelector(".text-gold-400.font-semibold"),n=t.querySelector(".text-gold-600"),a=t.querySelector(".flex.items-center.space-x-1 span");if(o&&n&&a){const t=o.textContent.trim().toLowerCase();n.hasAttribute("data-ticker-price")||(n.setAttribute("data-ticker-price",""),n.setAttribute("data-ticker-symbol",t)),a.hasAttribute("data-ticker-percent")||(a.setAttribute("data-ticker-percent",""),a.setAttribute("data-ticker-symbol",t))}})}null===marketTickerInterval&&(fetchAllTickerPrices(),marketTickerInterval=setInterval(fetchAllTickerPrices,3e4))}function updateTickerItem(t,e,o){const n=document.querySelectorAll(`[data-ticker-price][data-ticker-symbol="${t}"]`),a=document.querySelectorAll(`[data-ticker-percent][data-ticker-symbol="${t}"]`);let r=e;r=`$${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,n.forEach(t=>{t.textContent=r});const d=o>=0,s=`${d?"+":""}${o.toFixed(2)}%`;a.forEach(t=>{t.textContent=s});document.querySelectorAll(`[data-ticker-percent][data-ticker-symbol="${t}"]`).forEach(t=>{const e=t.closest(".flex.items-center.space-x-1");if(e){const t=e.querySelector("svg");d?(e.className="flex items-center space-x-1 text-green-400",t&&(t.innerHTML='<polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline>')):(e.className="flex items-center space-x-1 text-red-400",t&&(t.innerHTML='<polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline><polyline points="16 17 22 17 22 11"></polyline>'))}}),marketTickerCurrentPrices[t]=e}async function fetchCryptoPrices(){useFallbackCryptoPrices()}function useFallbackCryptoPrices(){const t=JSON.parse(getUserItem("tickerPrices")||"{}"),e=t.btc||43500,o=.5*Math.random()-.25,n=e*(1+o/100);updateTickerItem("btc",n,e?(n-e)/e*100:o);const a=t.eth||2550,r=.5*Math.random()-.25,d=a*(1+r/100);updateTickerItem("eth",d,a?(d-a)/a*100:r)}async function fetchCommodityPrices(){try{const t=JSON.parse(getUserItem("tickerPrices")||"{}"),e=t.gold||2055,o=.8*Math.random()-.4,n=e*(1+o/100);updateTickerItem("gold",n,e?(n-e)/e*100:o);const a=t.oil||82,r=.8*Math.random()-.4,d=a*(1+r/100);updateTickerItem("oil",d,a?(d-a)/a*100:r)}catch(t){console.error("Error fetching commodity prices:",t)}}function updateCustomTokens(){const t=JSON.parse(getUserItem("tickerPrices")||"{}"),e=t.bgc||.86,o=1*Math.random()-.5,n=e*(1+o/100);updateTickerItem("bgc",n,e?(n-e)/e*100:o);const a=t.solar||158,r=.8*Math.random()-.4,d=a*(1+r/100);updateTickerItem("solar",d,a?(d-a)/a*100:r);const s=t.wind||89,c=.8*Math.random()-.4,l=s*(1+c/100);updateTickerItem("wind",l,s?(l-s)/s*100:c)}async function fetchAllTickerPrices(){await Promise.all([fetchCryptoPrices(),fetchCommodityPrices(),Promise.resolve(updateCustomTokens())]),setUserItem("tickerPrices",JSON.stringify(marketTickerCurrentPrices))}function initTradingPage(){if(!(window.location.pathname.includes("trading.html")||window.location.href.includes("trading.html")||document.querySelector('[data-tab-panel="crypto"]')))return;initTradeButtons();const t=document.querySelector("table tbody");if(!t)return;const e={BTC:"bitcoin",ETH:"ethereum",ADA:"cardano",SOL:"solana"};async function o(){const o=Object.keys(e),n={BTC:43617,ETH:2567,ADA:.52,SOL:98.5};o.forEach(e=>{const o=n[e]||100,a=2*Math.random()-1,r=o*(1+a/100);Array.from(t.querySelectorAll("tr")).forEach(t=>{const o=t.querySelector(".font-semibold.text-gold-400");if(o&&o.textContent.trim()===e){const e=t.querySelector("td.text-right.text-gold-400.font-semibold");e&&(e.textContent=`$${r.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`);const o=t.querySelector("td.text-right.font-semibold");if(o&&(o.classList.contains("text-green-400")||o.classList.contains("text-red-400"))){const t=a>=0;o.textContent=`${t?"+":""}${a.toFixed(2)}%`,o.className="text-right py-4 font-semibold "+(t?"text-green-400":"text-red-400")}}})})}o(),setInterval(o,3e4)}function initTradeButtons(){const t=document.querySelectorAll("[data-trade-action]"),e=document.getElementById("trade-modal");if(!e)return;t.forEach(t=>{t.addEventListener("click",o=>{o.preventDefault();const n=t.getAttribute("data-trade-action"),a=t.getAttribute("data-trade-symbol"),r=t.getAttribute("data-trade-name");let d=0;const s=t.closest("tr");if(s){const t=s.querySelector("[data-crypto-price]")||s.querySelector(".text-right.text-gold-400.font-semibold");if(t){const e=t.textContent.replace("$","").replace(/,/g,"");d=parseFloat(e)||0}}else{let e=t.closest('[class*="bg-black"]');if(!e){let o=t.parentElement;for(;o&&o!==document.body;){if(o.classList.contains("bg-black")||o.className.includes("bg-black")){e=o;break}o=o.parentElement}}if(e){const t=e.querySelector(".text-xl.font-bold.text-gold-400")||e.querySelector(".text-2xl.font-bold.text-gold-400")||e.querySelector("p.text-xl.font-bold.text-gold-400");if(t){const e=t.textContent.replace("$","").replace(/,/g,"");d=parseFloat(e)||0}}}populateTradeModal(n,a,r,d),e.classList.remove("hidden"),document.body.style.overflow="hidden";const c=e.querySelector("[data-modal-backdrop]");c&&c.classList.remove("hidden")})});const o=e.querySelector("[data-trade-amount-input]");o&&o.addEventListener("input",()=>{calculateTradeTotals()});const n=e.querySelector("[data-trade-submit]");n&&n.addEventListener("click",()=>{const t=parseFloat(o.value)||0,a=e.querySelector("[data-trade-order-type]").value,r=n.querySelector("[data-trade-submit-text]").textContent.toLowerCase(),d=n.querySelector("[data-trade-symbol-text]").textContent;if(t<=0)alert("Please enter a valid amount");else{if("buy"===r){const o=e.querySelector("[data-trade-final-amount]");let n=t;if(o){const e=o.textContent.replace("$","").replace(/,/g,"");n=parseFloat(e)||t}else{n=t+.001*t}const a=loadBankAccounts().find(t=>"current"===t.accountType);if(!a)return void alert("No current account found. Please set up a current account first.");if(a.balance<n)return void alert(`Insufficient balance. You need $${n.toFixed(2)} but only have $${a.balance.toFixed(2)}.`);a.balance-=n;const r=loadBankAccounts(),d=r.findIndex(t=>t.id===a.id);-1!==d?r[d]=a:r.push(a);const s=getCurrentUserId();if(s&&"function"==typeof saveUserAccounts)saveUserAccounts(s,r);else{const t=getUserStorageKey("bankAccounts");localStorage.setItem(t,JSON.stringify(r))}window.updateHeaderBalance&&window.updateHeaderBalance()}console.log(`Executing ${r} order:`,{symbol:d,amount:t,orderType:a}),alert(`${"buy"===r?"Buy":"Sell"} order for ${t} ${d} submitted successfully!`),closeTradeModal()}})}function populateTradeModal(t,e,o,n){const a=document.getElementById("trade-modal");if(!a)return;const r=a.querySelector("[data-trade-modal-title]");r&&(r.textContent=`${"buy"===t?"Buy":"Sell"} ${e}`);const d=a.querySelector("[data-trade-current-price]");if(d){let t;t=n<1?n.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}):n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),d.textContent=`$${t}`}const s=a.querySelector("[data-trade-amount-label]");s&&(s.textContent=`Amount to ${t}`);const c=a.querySelector("[data-trade-submit-text]"),l=a.querySelector("[data-trade-symbol-text]");c&&(c.textContent="buy"===t?"Buy":"Sell"),l&&(l.textContent=e);const i=a.querySelector("[data-trade-amount-input]");i&&(i.value="");const u=a.querySelector("[data-trade-estimated-total]"),m=a.querySelector("[data-trade-final-amount]");u&&(u.textContent="$0.00"),m&&(m.textContent="$0.00"),a.dataset.currentPrice=n.toString()}function calculateTradeTotals(){const t=document.getElementById("trade-modal");if(!t)return;const e=t.querySelector("[data-trade-amount-input]"),o=parseFloat(t.dataset.currentPrice)||0,n=parseFloat(e.value)||0;if(n>0&&o>0){const e=n*o,a=e+.001*e,r=t.querySelector("[data-trade-estimated-total]"),d=t.querySelector("[data-trade-final-amount]");r&&(r.textContent=`$${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`),d&&(d.textContent=`$${a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`)}else{const e=t.querySelector("[data-trade-estimated-total]"),o=t.querySelector("[data-trade-final-amount]");e&&(e.textContent="$0.00"),o&&(o.textContent="$0.00")}}function closeTradeModal(){const t=document.getElementById("trade-modal");if(t){t.classList.add("hidden"),document.body.style.overflow="";const e=t.querySelector("[data-modal-backdrop]");e&&e.classList.add("hidden");const o=t.querySelector("[data-trade-amount-input]");o&&(o.value="")}}function initTradeModalClose(){const t=document.getElementById("trade-modal");if(!t)return;t.querySelectorAll('[data-modal-close="trade-modal"]').forEach(t=>{t.addEventListener("click",closeTradeModal)});const e=t.querySelector('[data-modal-backdrop="trade-modal"]');e&&e.addEventListener("click",closeTradeModal),document.addEventListener("keydown",e=>{"Escape"!==e.key||t.classList.contains("hidden")||closeTradeModal()})}function initSharesPage(){if(!(window.location.pathname.includes("shares.html")||window.location.href.includes("shares.html")||document.querySelector("h1")?.textContent.includes("Company Shares")))return;const t=["TSLA","AAPL","SHEL","MSFT","NVDA","XOM"];async function e(){t.forEach(t=>{!function(t){const e={TSLA:{base:248,variation:20},AAPL:{base:192,variation:10},SHEL:{base:55,variation:5},MSFT:{base:380,variation:15},NVDA:{base:480,variation:30},XOM:{base:110,variation:8}}[t];if(!e)return;const o=JSON.parse(getUserItem("stockPrices")||"{}"),n=o[t]||e.base,a=1.5*Math.random()-.75,r=n*(1+a/100),d=e.base-e.variation,s=e.base+e.variation,c=Math.max(d,Math.min(s,r)),l=c-n,i=n?(c-n)/n*100:a;o[t]=c,setUserItem("stockPrices",JSON.stringify(o)),function(t,e,o,n){const a=o>=0;document.querySelectorAll("table tbody tr").forEach(o=>{const n=o.querySelector(".font-semibold.text-gold-400");if(n&&n.textContent.trim()===t){const t=o.querySelectorAll("td.text-right.text-gold-400.font-semibold")[0],n=o.querySelectorAll("td.text-right.text-gold-600")[0];if(t&&n){const r=parseInt(t.textContent)||0,d=parseFloat(n.textContent.replace("$",""))||e,s=r*e,c=(e-d)*r,l=(e-d)/d*100,i=o.querySelectorAll("td.text-right.text-gold-400.font-semibold")[1];i&&(i.textContent=`$${s.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`);const u=o.querySelectorAll("td.text-right.font-semibold")[1];u&&(u.textContent=`${a?"+":""}$${Math.abs(c).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} (${a?"+":""}${l.toFixed(2)}%)`,u.className="text-right py-4 font-semibold "+(a?"text-green-400":"text-red-400"))}}});document.querySelectorAll(".bg-black\\/60.backdrop-blur-sm.border").forEach(r=>{const d=r.querySelector(".text-lg.font-semibold.text-gold-400");if(d&&d.textContent.trim()===t){const d=r.querySelector(".text-2xl.font-bold.text-gold-400");d&&(d.textContent=`$${e.toFixed(2)}`);const s=r.querySelector(".flex.items-center.space-x-1 span");if(s){const t=Math.abs(o);s.textContent=`${a?"+":"-"}$${t.toFixed(2)} (${a?"+":""}${n.toFixed(2)}%)`;const e=s.closest(".flex.items-center.space-x-1");if(e){e.className="flex items-center space-x-1 text-sm font-semibold "+(a?"text-green-400":"text-red-400");const t=e.querySelector("svg");t&&(a?t.innerHTML='<polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline>':(t.innerHTML='<polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline><polyline points="16 17 22 17 22 11"></polyline>',t.style.transform="rotate(180deg)"))}}r.querySelectorAll("[data-trade-data]").forEach(r=>{try{const d=JSON.parse(r.getAttribute("data-trade-data"));d.symbol===t&&(d.price=`$${e.toFixed(2)}`,d.change=`${a?"+":""}$${Math.abs(o).toFixed(2)} (${a?"+":""}${n.toFixed(2)}%)`,r.setAttribute("data-trade-data",JSON.stringify(d)))}catch(t){console.error("Error updating trade data:",t)}})}})}(t,c,l,i)}(t)})}e(),setInterval(e,5e3)}function initWatchlist(){JSON.parse(getUserItem("watchlist")||'["TSLA", "AAPL"]');function t(){return JSON.parse(getUserItem("watchlist")||'["TSLA", "AAPL"]')}function e(e,o){let n=t();return o?n.includes(e)||n.push(e):n=n.filter(t=>t!==e),setUserItem("watchlist",JSON.stringify(n)),n}function o(){const e=t();document.querySelectorAll("[data-watchlist-toggle]").forEach(t=>{const o=t.getAttribute("data-watchlist-toggle"),n=e.includes(o),a=t.querySelector("svg");n?(t.classList.remove("text-gold-600"),t.classList.add("text-gold-400","bg-gold-600/20"),a&&a.setAttribute("fill","currentColor")):(t.classList.remove("text-gold-400","bg-gold-600/20"),t.classList.add("text-gold-600"),a&&a.setAttribute("fill","none"))});document.querySelectorAll(".text-2xl.font-bold.text-blue-400").forEach(t=>{const o=t.parentElement;o&&o.textContent.includes("Watchlist")&&(t.textContent=e.length)});const o=document.querySelector("[data-stock-watchlist-toggle]"),n=document.querySelector("[data-stock-watchlist-text]");if(o&&n){const t=document.querySelector("[data-stock-modal-symbol]")?.textContent;if(t){const o=e.includes(t);n.textContent=o?"Remove from Watchlist":"Add to Watchlist"}}}document.querySelectorAll("[data-watchlist-toggle]").forEach(n=>{n.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation();const r=n.getAttribute("data-watchlist-toggle");e(r,!t().includes(r)),o()})}),window.updateWatchlistFromModal=function(n){e(n,!t().includes(n)),o()},o(),window.updateWatchlistButtons=o}function initStockModal(){const t=document.getElementById("stock-modal");if(!t)return;const e={Technology:"text-blue-400 bg-blue-600/20",Energy:"text-orange-400 bg-orange-600/20",Automotive:"text-green-400 bg-green-600/20"};document.querySelectorAll("[data-stock-modal-open]").forEach(o=>{o.addEventListener("click",n=>{n.preventDefault();const a=o.getAttribute("data-stock-symbol"),r=o.getAttribute("data-stock-name"),d=parseFloat(o.getAttribute("data-stock-price"))||0,s=parseFloat(o.getAttribute("data-stock-change"))||0,c=parseFloat(o.getAttribute("data-stock-change-percent"))||0,l=o.getAttribute("data-stock-market-cap"),i=o.getAttribute("data-stock-volume"),u=o.getAttribute("data-stock-sector"),m=o.getAttribute("data-stock-description"),g=o.getAttribute("data-stock-logo"),p=t.querySelector("[data-stock-modal-title]"),f=t.querySelector("[data-stock-modal-logo]"),y=t.querySelector("[data-stock-modal-symbol]"),h=t.querySelector("[data-stock-modal-name]"),b=t.querySelector("[data-stock-modal-sector]"),v=t.querySelector("[data-stock-modal-price]"),x=t.querySelector("[data-stock-modal-change]"),S=t.querySelector("[data-stock-modal-description]"),k=t.querySelector("[data-stock-modal-market-cap]"),L=t.querySelector("[data-stock-modal-volume]"),E=t.querySelector("[data-stock-watchlist-text]");if(p&&(p.textContent=`${a} - ${r}`),f&&(f.textContent=g),y&&(y.textContent=a),h&&(h.textContent=r),b&&(b.textContent=u,b.className=`inline-block px-2 py-1 rounded text-xs font-medium mt-2 ${e[u]||"text-gold-400 bg-gold-600/20"}`),v&&(v.textContent=`$${d}`),x){const t=s>=0?"+":"",e=c>=0?"+":"";x.textContent=`${t}$${Math.abs(s)} (${e}${c}%)`,x.className="font-semibold "+(s>=0?"text-green-400":"text-red-400")}S&&(S.textContent=m),k&&(k.textContent=l),L&&(L.textContent=i);const q=JSON.parse(getUserItem("watchlist")||'["TSLA", "AAPL"]');E&&(E.textContent=q.includes(a)?"Remove from Watchlist":"Add to Watchlist"),t.dataset.currentSymbol=a,window.updateWatchlistButtons,t.classList.remove("hidden"),document.body.style.overflow="hidden";const A=t.querySelector('[data-modal-backdrop="stock-modal"]');A&&A.classList.remove("hidden")})});const o=t.querySelector("[data-stock-watchlist-toggle]");o&&o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const o=t.dataset.currentSymbol;if(o&&window.updateWatchlistFromModal){const e=JSON.parse(getUserItem("watchlist")||'["TSLA", "AAPL"]').includes(o);window.updateWatchlistFromModal(o);const n=t.querySelector("[data-stock-watchlist-text]");n&&(n.textContent=e?"Add to Watchlist":"Remove from Watchlist"),window.updateWatchlistButtons&&window.updateWatchlistButtons()}});const n=t.querySelector("[data-stock-buy]"),a=t.querySelector("[data-stock-sell]"),r=t.querySelector("[data-stock-shares-input]");r&&(r.addEventListener("click",t=>{t.stopPropagation()}),r.addEventListener("focus",t=>{t.stopPropagation()})),n&&n.addEventListener("click",e=>{e.stopPropagation();const o=parseInt(r.value)||0,n=t.dataset.currentSymbol;o>0?(alert(`Buy order for ${o} shares of ${n} submitted!`),closeStockModal()):alert("Please enter a valid number of shares")}),a&&a.addEventListener("click",e=>{e.stopPropagation();const o=parseInt(r.value)||0,n=t.dataset.currentSymbol;o>0?(alert(`Sell order for ${o} shares of ${n} submitted!`),closeStockModal()):alert("Please enter a valid number of shares")});const d=t.querySelector("div.rounded-xl");d&&d.addEventListener("click",t=>{t.stopPropagation()});t.querySelectorAll('[data-modal-close="stock-modal"]').forEach(t=>{t.addEventListener("click",t=>{t.stopPropagation(),closeStockModal()})}),t.addEventListener("click",e=>{e.target===t&&closeStockModal()});const s=t.querySelector('[data-modal-backdrop="stock-modal"]');s&&s.addEventListener("click",t=>{t.stopPropagation(),closeStockModal()}),document.addEventListener("keydown",e=>{"Escape"!==e.key||t.classList.contains("hidden")||closeStockModal()})}function closeStockModal(){const t=document.getElementById("stock-modal");if(t){t.classList.add("hidden"),document.body.style.overflow="";const e=t.querySelector('[data-modal-backdrop="stock-modal"]');e&&e.classList.add("hidden");const o=t.querySelector("[data-stock-shares-input]");o&&(o.value="")}}let authChecked=!1,redirecting=!1;function checkAuthentication(){if(authChecked||redirecting)return!0;const t=window.location.pathname,e=window.location.href;if(t.includes("login.html")||e.includes("login.html"))return authChecked=!0,!0;try{const t=localStorage.getItem("currentUserId");return t&&"null"!==t&&"undefined"!==t&&""!==t.trim()?(authChecked=!0,!0):(redirecting||(redirecting=!0,authChecked=!0,setTimeout(()=>{window.location.pathname.includes("login.html")||window.location.replace("login.html")},100)),!1)}catch(t){return authChecked=!0,!0}}function getCurrentUserId(){return localStorage.getItem("currentUserId")}function loadBankAccounts(){const t=getCurrentUserId();if(!t)return[];if("function"==typeof getUserAccounts)return getUserAccounts(t);const e=localStorage.getItem("bankAccounts");return e?JSON.parse(e):[]}function updateHeaderBalance(){const t=document.querySelector("[data-header-balance]");if(t){const e=loadBankAccounts().filter(t=>"current"===t.accountType).reduce((t,e)=>t+e.balance,0);t.textContent=`$${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}const e=document.querySelector("[data-profile-balance]");if(e){const t=loadBankAccounts().reduce((t,e)=>t+e.balance,0);e.textContent=`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}}function initBankPage(){const t=document.getElementById("bank-accounts-grid"),e=document.getElementById("add-account-modal"),o=document.getElementById("add-account-submit");if(t){if(o&&e&&o.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const o=document.getElementById("account-bank-name"),r=document.getElementById("account-iban"),s=document.getElementById("account-type");if(!o||!r||!s)return;const c=o.value.trim(),l=r.value.trim(),i=s.value;if(!c||!l)return void alert("Please fill in all fields");const u=n();"current"===i&&u.forEach(t=>{"current"===t.accountType&&(t.accountType="savings")});const m={id:Date.now(),bankName:c,iban:l,accountType:i,balance:0};u.push(m),a(u),d(),o.value="",r.value="",s.value="current",e.classList.add("hidden"),document.body.style.overflow=""}),e){const t=e.querySelector("div.rounded-xl");t&&t.addEventListener("click",t=>{t.stopPropagation()});e.querySelectorAll("input, select, button").forEach(t=>{t.addEventListener("click",t=>{t.stopPropagation()})})}!function(){const t=document.getElementById("deposit-account-modal"),e=document.getElementById("deposit-submit"),o=document.getElementById("delete-account-submit"),r=document.getElementById("deposit-amount"),s=document.getElementById("deposit-account-type"),c=document.getElementById("deposit-card-number"),l=document.getElementById("deposit-card-date"),i=document.getElementById("deposit-card-cvc");if(!(t&&e&&r&&s))return;c&&(c.addEventListener("input",t=>{!function(t){let e=t.value.replace(/\D/g,"");e.length>16&&(e=e.slice(0,16));let o="";for(let t=0;t<e.length;t++)t>0&&t%4==0&&(o+="-"),o+=e[t];t.value=o}(t.target)}),c.addEventListener("keypress",t=>{/[0-9]/.test(t.key)||["Backspace","Delete","Tab","ArrowLeft","ArrowRight"].includes(t.key)||t.preventDefault()})),l&&(l.addEventListener("input",t=>{!function(t){let e=t.value.replace(/\D/g,"");e.length>4&&(e=e.slice(0,4)),e.length>=2?t.value=e.slice(0,2)+"/"+e.slice(2):t.value=e}(t.target)}),l.addEventListener("keypress",t=>{/[0-9]/.test(t.key)||["Backspace","Delete","Tab","ArrowLeft","ArrowRight"].includes(t.key)||t.preventDefault()})),i&&(i.addEventListener("input",t=>{var e;(e=t.target).value=e.value.replace(/\D/g,"").slice(0,3)}),i.addEventListener("keypress",t=>{/[0-9]/.test(t.key)||["Backspace","Delete","Tab","ArrowLeft","ArrowRight"].includes(t.key)||t.preventDefault()})),e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const o=parseInt(t.dataset.accountId),s=parseFloat(r.value),u=document.getElementById("deposit-card-name")?.value.trim(),m=c?.value.replace(/-/g,""),g=l?.value,p=i?.value;if(!u)return void alert("Please enter the name on the card");if(!m||16!==m.length)return void alert("Please enter a valid 16-digit card number");if(!g||!/^\d{2}\/\d{2}$/.test(g))return void alert("Please enter a valid expiry date (MM/YY)");if(!p||3!==p.length)return void alert("Please enter a valid 3-digit CVC");if(!o||isNaN(s)||s<=0)return void alert("Please enter a valid deposit amount");const f=n(),y=f.findIndex(t=>t.id===o);if(-1===y)return void alert("Account not found");f[y].balance+=s,a(f),d();const h=document.querySelector(`[data-account-balance="${o}"]`);h&&(h.textContent=`$${f[y].balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`),t.classList.add("hidden"),document.body.style.overflow="",r.value="",c&&(c.value=""),l&&(l.value=""),i&&(i.value=""),document.getElementById("deposit-card-name")&&(document.getElementById("deposit-card-name").value="")}),s.addEventListener("change",e=>{e.stopPropagation();const o=parseInt(t.dataset.accountId);if(!o)return;const r=s.value,c=n(),l=c.findIndex(t=>t.id===o);-1!==l&&("current"===r&&c.forEach((t,e)=>{e!==l&&"current"===t.accountType&&(t.accountType="savings")}),c[l].accountType=r,a(c),d())}),o&&o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const o=parseInt(t.dataset.accountId);if(!o)return;if(!confirm("Are you sure you want to delete this account? This action cannot be undone."))return;a(n().filter(t=>t.id!==o)),d(),t.classList.add("hidden"),document.body.style.overflow=""});const u=t.querySelector("div.rounded-xl");u&&u.addEventListener("click",t=>{t.stopPropagation()}),t.querySelectorAll("input, select, button").forEach(t=>{t.addEventListener("click",t=>{t.stopPropagation()}),t.addEventListener("focus",t=>{t.stopPropagation()})})}(),d()}function n(){return loadBankAccounts()}function a(t){const e=getCurrentUserId();e&&("function"==typeof saveUserAccounts?saveUserAccounts(e,t):localStorage.setItem("bankAccounts",JSON.stringify(t)),updateHeaderBalance())}function r(t){const e=document.createElement("div");var o;return e.className="bg-black/60 backdrop-blur-sm border border-gold-600/30 rounded-xl p-6 hover:bg-black/70 hover:border-gold-500/50 transition-all duration-300 shadow-lg shadow-gold-600/20 cursor-pointer",e.setAttribute("data-account-id",t.id),e.innerHTML=`\n      <div class="flex items-center space-x-4 mb-4">\n        <div class="text-3xl">${o=t.accountType,{current:"üè¶",savings:"üí≥",business:"üè¢"}[o]||"üè¶"}</div>\n        <div>\n          <h3 class="text-lg font-semibold text-gold-400">${t.bankName}</h3>\n          <p class="text-sm text-gold-600">${function(t){return{current:"Current Account",savings:"Savings Account",business:"Business Account"}[t]||"Account"}(t.accountType)}</p>\n        </div>\n      </div>\n      <div class="space-y-2">\n        <div class="flex justify-between">\n          <span class="text-gold-600">IBAN:</span>\n          <span class="text-gold-400 font-mono text-sm">${t.iban}</span>\n        </div>\n        <div class="flex justify-between">\n          <span class="text-gold-600">Balance:</span>\n          <span class="text-gold-400 font-semibold" data-account-balance="${t.id}">$${t.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>\n        </div>\n      </div>\n    `,e.addEventListener("click",()=>{!function(t){const e=document.getElementById("deposit-account-modal"),o=document.getElementById("deposit-bank-name"),n=document.getElementById("deposit-current-balance"),a=document.getElementById("deposit-amount"),r=document.getElementById("deposit-account-type"),d=document.getElementById("deposit-card-name"),s=document.getElementById("deposit-card-number"),c=document.getElementById("deposit-card-date"),l=document.getElementById("deposit-card-cvc");if(!(e&&o&&n&&a&&r))return;o.textContent=t.bankName,n.textContent=`$${t.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,a.value="",r.value=t.accountType,d&&(d.value="");s&&(s.value="");c&&(c.value="");l&&(l.value="");e.dataset.accountId=t.id,e.classList.remove("hidden"),document.body.style.overflow="hidden"}(t)}),e}function d(){const e=n();t.innerHTML="",e.forEach(e=>{const o=r(e);t.appendChild(o)}),updateHeaderBalance()}}function getUserStorageKey(t){const e=getCurrentUserId();return e?`user_${e}_${t}`:t}function getUserItem(t){if(!getCurrentUserId())return localStorage.getItem(t);const e=getUserStorageKey(t),o=localStorage.getItem(e);return null!==o?o:localStorage.getItem(t)}function setUserItem(t,e){const o=getCurrentUserId();if(!o)return void localStorage.setItem(t,e);const n=getUserStorageKey(t);if(localStorage.setItem(n,e),"function"==typeof updateUserProperty){const n={userName:"name",selectedLanguage:"language",theme:"theme",notifications:"notifications",watchlist:"watchlist",tickerPrices:"cryptoPrices",stockPrices:"stockPrices"};if(n[t])try{const a=e.startsWith("{")||e.startsWith("[")?JSON.parse(e):e;updateUserProperty(o,n[t],a)}catch(a){updateUserProperty(o,n[t],e)}}}function initializePage(){if(getCurrentUserId()&&"function"==typeof getCurrentUser){const t=getCurrentUser();t&&(t.name&&!localStorage.getItem(getUserStorageKey("userName"))&&setUserItem("userName",t.name),t.theme&&setUserItem("theme",t.theme),t.language&&setUserItem("selectedLanguage",t.language),void 0!==t.notifications&&setUserItem("notifications",t.notifications.toString()),t.watchlist&&setUserItem("watchlist",JSON.stringify(t.watchlist)),t.cryptoPrices&&setUserItem("tickerPrices",JSON.stringify(t.cryptoPrices)),t.stockPrices&&setUserItem("stockPrices",JSON.stringify(t.stockPrices)))}initTheme(),loadUserName(),updateHeaderBalance(),initTabs(),initModals(),initLanguageDropdown(),initForecastPage(),initProfilePage(),initBankPage(),initMarketTicker(),initTradingPage(),initSharesPage(),initTradeModalClose(),initWatchlist(),initStockModal()}window.updateHeaderBalance=updateHeaderBalance,document.addEventListener("DOMContentLoaded",()=>{const t=window.location.pathname,e=window.location.href;t.includes("login.html")||e.includes("login.html")||initializePage()});